var x=Object.create;var c=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var T=(n,e)=>{for(var t in e)c(n,t,{get:e[t],enumerable:!0})},h=(n,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of y(e))!P.call(n,i)&&i!==t&&c(n,i,{get:()=>e[i],enumerable:!(a=$(e,i))||a.enumerable});return n};var u=(n,e,t)=>(t=n!=null?x(S(n)):{},h(e||!n||!n.__esModule?c(t,"default",{value:n,enumerable:!0}):t,n)),D=n=>h(c({},"__esModule",{value:!0}),n);var C={};T(C,{default:()=>l});module.exports=D(C);var s=require("obsidian"),g=u(require("fs")),f=u(require("path"));function v(n){return`${n}/active-note.json`}var A={pointerFilePath:"",debounceMs:300},l=class extends s.Plugin{constructor(){super(...arguments);this.debounceTimer=null}get pointerFilePath(){return this.settings.pointerFilePath||v(this.app.vault.configDir)}async onload(){await this.loadSettings(),this.addSettingTab(new p(this.app,this)),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>this.writePointer())),this.registerDomEvent(activeWindow,"keyup",()=>this.writePointerDebounced()),this.registerDomEvent(activeWindow,"mouseup",()=>this.writePointerDebounced())}onunload(){this.debounceTimer&&clearTimeout(this.debounceTimer)}writePointerDebounced(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>this.writePointer(),this.settings.debounceMs)}writePointer(){let t=this.app.workspace.getActiveViewOfType(s.MarkdownView);if(!(t!=null&&t.file))return;let a=t.editor,i=a.getSelection(),o={path:t.file.path};if(i){let d=a.getCursor("from"),w=a.getCursor("to");o.selection={text:i,startLine:d.line+1,endLine:w.line+1}}let m=this.app.vault.adapter.getBasePath(),b=f.join(m,this.pointerFilePath);try{g.writeFileSync(b,JSON.stringify(o),"utf8")}catch(d){console.error("Active Note plugin failed to write pointer file",d)}}async loadSettings(){this.settings=Object.assign({},A,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},p=class extends s.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new s.Setting(e).setName("General").setHeading(),new s.Setting(e).setName("Pointer file path").setDesc("Relative path from vault root where the active note state is written").addText(i=>i.setPlaceholder(v(this.app.vault.configDir)).setValue(this.plugin.settings.pointerFilePath).onChange(async o=>{this.plugin.settings.pointerFilePath=o,await this.plugin.saveSettings()})),new s.Setting(e).setName("Debounce interval").setDesc("Delay in milliseconds before writing selection changes to the pointer file").addText(i=>i.setPlaceholder("300").setValue(String(this.plugin.settings.debounceMs)).onChange(async o=>{let r=parseInt(o,10);!isNaN(r)&&r>=0&&(this.plugin.settings.debounceMs=r,await this.plugin.saveSettings())})),new s.Setting(e).setName("Claude Code integration").setHeading(),this.addSnippetBlock(e,{name:"CLAUDE.md snippet",desc:"Add this to your vault's CLAUDE.md so Claude Code understands the pointer file",text:'## Active Note Context\n\nThe Obsidian plugin "Active Note" writes the currently open note and any selected text to `.obsidian/active-note.json`.\n\nWhen I reference a file with `@.` \u2014 read `.obsidian/active-note.json` to resolve which note I mean.\n\nFormat (JSON):\n- `path` \u2014 vault-relative path to the active note (always present)\n- `selection` \u2014 only present when text is selected:\n  - `text` \u2014 the selected text\n  - `startLine` / `endLine` \u2014 1-indexed line range\n\nWhen a selection is present and I refer to "this", "this part", or "the highlighted text", use the selection text and line numbers as context.'}),this.addSnippetBlock(e,{name:"Claude Code status line",desc:"Add this to your Claude Code settings (~/.claude/settings.json) to show the active note in the status bar. Shows the note filename and a dot when text is selected.",text:`"statusLine": {
  "type": "command",
  "command": "input=$(cat); dir=$(echo \\"$input\\" | jq -r '.workspace.current_dir'); cd \\"$dir\\" 2>/dev/null && branch=$(git rev-parse --abbrev-ref HEAD 2>/dev/null); note=''; anf=\\"$dir/.obsidian/active-note.json\\"; if [ -f \\"$anf\\" ]; then p=$(jq -r '.path // empty' \\"$anf\\" 2>/dev/null); if [ -n \\"$p\\" ]; then fn=\\"\${p##*/}\\"; fn=\\"\${fn%.md}\\"; if [ \${#fn} -gt 40 ]; then fn=\\"\${fn:0:37}...\\"; fi; sel=$(jq -r '.selection.text // empty' \\"$anf\\" 2>/dev/null); if [ -n \\"$sel\\" ]; then note=\\"@. $fn | \u25CF\\"; else note=\\"@. $fn\\"; fi; fi; fi; out=$(echo \\"$dir\\" | sed \\"s|^$HOME|~|\\"); if [ -n \\"$branch\\" ]; then out=\\"$out (git: $branch)\\"; fi; if [ -n \\"$note\\" ]; then out=\\"$out | $note\\"; fi; echo -e \\"$out\\""
}`})}addSnippetBlock(e,t){let a=e.createDiv({cls:"active-note-snippet-block"});a.createEl("div",{text:t.name,cls:"setting-item-name"}),a.createEl("div",{text:t.desc,cls:"setting-item-description"});let i=a.createDiv({cls:"active-note-snippet-box"}),o=i.createEl("textarea",{cls:t.text.includes(`
`)?"active-note-snippet-tall":"active-note-snippet-short"});o.value=t.text,i.createEl("button",{text:"Copy to clipboard",cls:"active-note-snippet-copy-btn"}).addEventListener("click",()=>{navigator.clipboard.writeText(o.value),new s.Notice("Copied to clipboard")})}};
