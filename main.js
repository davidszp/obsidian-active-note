var x=Object.create;var l=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var S=(n,e)=>{for(var t in e)l(n,t,{get:e[t],enumerable:!0})},h=(n,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of b(e))!$.call(n,i)&&i!==t&&l(n,i,{get:()=>e[i],enumerable:!(a=y(e,i))||a.enumerable});return n};var u=(n,e,t)=>(t=n!=null?x(w(n)):{},h(e||!n||!n.__esModule?l(t,"default",{value:n,enumerable:!0}):t,n)),T=n=>h(l({},"__esModule",{value:!0}),n);var E={};S(E,{default:()=>c});module.exports=T(E);var r=require("obsidian"),g=u(require("fs")),f=u(require("path")),P={pointerFilePath:".obsidian/active-note.json",debounceMs:300},c=class extends r.Plugin{constructor(){super(...arguments);this.debounceTimer=null}async onload(){await this.loadSettings(),this.addSettingTab(new p(this.app,this)),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>this.writePointer())),this.registerDomEvent(activeWindow,"keyup",()=>this.writePointerDebounced()),this.registerDomEvent(activeWindow,"mouseup",()=>this.writePointerDebounced())}onunload(){this.debounceTimer&&clearTimeout(this.debounceTimer)}writePointerDebounced(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>this.writePointer(),this.settings.debounceMs)}writePointer(){let t=this.app.workspace.getActiveViewOfType(r.MarkdownView);if(!(t!=null&&t.file))return;let a=t.editor,i=a.getSelection(),s={path:t.file.path};if(i){let d=a.getCursor("from"),v=a.getCursor("to");s.selection={text:i,startLine:d.line+1,endLine:v.line+1}}let o=this.app.vault.adapter.getBasePath(),m=f.join(o,this.settings.pointerFilePath);try{g.writeFileSync(m,JSON.stringify(s),"utf8")}catch(d){console.error("Active Note plugin failed to write pointer file",d)}}async loadSettings(){this.settings=Object.assign({},P,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},p=class extends r.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h3",{text:"General"}),new r.Setting(e).setName("Pointer file path").setDesc("Relative path from vault root where the active note state is written").addText(i=>i.setPlaceholder(".obsidian/active-note.json").setValue(this.plugin.settings.pointerFilePath).onChange(async s=>{this.plugin.settings.pointerFilePath=s,await this.plugin.saveSettings()})),new r.Setting(e).setName("Debounce interval").setDesc("Delay in milliseconds before writing selection changes to the pointer file").addText(i=>i.setPlaceholder("300").setValue(String(this.plugin.settings.debounceMs)).onChange(async s=>{let o=parseInt(s,10);!isNaN(o)&&o>=0&&(this.plugin.settings.debounceMs=o,await this.plugin.saveSettings())})),e.createEl("h3",{text:"Claude Code Integration"}),this.addSnippetBlock(e,{name:"CLAUDE.md snippet",desc:"Add this to your vault's CLAUDE.md so Claude Code understands the pointer file",text:'## Active Note Context\n\nThe Obsidian plugin "Active Note" writes the currently open note and any selected text to `.obsidian/active-note.json`.\n\nWhen I reference a file with `@.` \u2014 read `.obsidian/active-note.json` to resolve which note I mean.\n\nFormat (JSON):\n- `path` \u2014 vault-relative path to the active note (always present)\n- `selection` \u2014 only present when text is selected:\n  - `text` \u2014 the selected text\n  - `startLine` / `endLine` \u2014 1-indexed line range\n\nWhen a selection is present and I refer to "this", "this part", or "the highlighted text", use the selection text and line numbers as context.'}),this.addSnippetBlock(e,{name:"Claude Code status line",desc:"Add this to your Claude Code settings (~/.claude/settings.json) to show the active note in the status bar. Shows the note filename and a dot when text is selected.",text:`"statusLine": {
  "type": "command",
  "command": "input=$(cat); dir=$(echo \\"$input\\" | jq -r '.workspace.current_dir'); cd \\"$dir\\" 2>/dev/null && branch=$(git rev-parse --abbrev-ref HEAD 2>/dev/null); note=''; anf=\\"$dir/.obsidian/active-note.json\\"; if [ -f \\"$anf\\" ]; then p=$(jq -r '.path // empty' \\"$anf\\" 2>/dev/null); if [ -n \\"$p\\" ]; then fn=\\"\${p##*/}\\"; fn=\\"\${fn%.md}\\"; if [ \${#fn} -gt 40 ]; then fn=\\"\${fn:0:37}...\\"; fi; sel=$(jq -r '.selection.text // empty' \\"$anf\\" 2>/dev/null); if [ -n \\"$sel\\" ]; then note=\\"@. $fn | \u25CF\\"; else note=\\"@. $fn\\"; fi; fi; fi; out=$(echo \\"$dir\\" | sed \\"s|^$HOME|~|\\"); if [ -n \\"$branch\\" ]; then out=\\"$out (git: $branch)\\"; fi; if [ -n \\"$note\\" ]; then out=\\"$out | $note\\"; fi; echo -e \\"$out\\""
}`})}addSnippetBlock(e,t){let a=e.createDiv({cls:"active-note-snippet-block"});a.style.marginBottom="1.5em",a.createEl("div",{text:t.name,cls:"setting-item-name"}),a.createEl("div",{text:t.desc,cls:"setting-item-description"});let i=a.createDiv();i.style.position="relative",i.style.marginTop="8px";let s=i.createEl("textarea");s.value=t.text,s.style.width="100%",s.style.minHeight=t.text.includes(`
`)?"220px":"50px",s.style.fontFamily="monospace",s.style.fontSize="12px",s.style.resize="vertical",s.style.padding="10px",s.style.paddingTop="36px";let o=i.createEl("button",{text:"Copy to clipboard"});o.style.position="absolute",o.style.top="6px",o.style.right="6px",o.style.fontSize="11px",o.style.padding="2px 8px",o.style.cursor="pointer",o.addEventListener("click",()=>{navigator.clipboard.writeText(s.value),new r.Notice("Copied to clipboard")})}};
