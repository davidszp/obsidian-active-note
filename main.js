var w=Object.create;var a=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var b=(i,e)=>{for(var t in e)a(i,t,{get:e[t],enumerable:!0})},p=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of T(e))!S.call(i,s)&&s!==t&&a(i,s,{get:()=>e[s],enumerable:!(n=P(e,s))||n.enumerable});return i};var u=(i,e,t)=>(t=i!=null?w(y(i)):{},p(e||!i||!i.__esModule?a(t,"default",{value:i,enumerable:!0}):t,i)),D=i=>p(a({},"__esModule",{value:!0}),i);var F={};b(F,{default:()=>r});module.exports=D(F);var o=require("obsidian"),d=u(require("fs")),g=u(require("path")),A={pointerFilePath:".obsidian/active-note.json"},r=class extends o.Plugin{constructor(){super(...arguments);this.debounceTimer=null}async onload(){await this.loadSettings(),this.addSettingTab(new h(this.app,this)),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>this.writePointer())),this.registerDomEvent(activeWindow,"keyup",()=>this.writePointerDebounced()),this.registerDomEvent(activeWindow,"mouseup",()=>this.writePointerDebounced())}onunload(){this.debounceTimer&&clearTimeout(this.debounceTimer)}writePointerDebounced(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>this.writePointer(),300)}writePointer(){let t=this.app.workspace.getActiveViewOfType(o.MarkdownView);if(!(t!=null&&t.file))return;let n=t.editor,s=n.getSelection(),l={path:t.file.path};if(s){let c=n.getCursor("from"),v=n.getCursor("to");l.selection={text:s,startLine:c.line+1,endLine:v.line+1}}let f=this.app.vault.adapter.getBasePath(),m=g.join(f,this.settings.pointerFilePath);try{d.writeFileSync(m,JSON.stringify(l),"utf8")}catch(c){console.error("Active Note plugin failed to write pointer file",c)}}async loadSettings(){this.settings=Object.assign({},A,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},h=class extends o.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new o.Setting(e).setName("Pointer file path").setDesc("Relative path from vault root where the active note state is written").addText(t=>t.setPlaceholder(".obsidian/active-note.json").setValue(this.plugin.settings.pointerFilePath).onChange(async n=>{this.plugin.settings.pointerFilePath=n,await this.plugin.saveSettings()}))}};
